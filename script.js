document.addEventListener("DOMContentLoaded", () => {
  // Sample data for the videos with channel renamed to category and sponsor removed
  const videos = [
    {
      id: "1",
      title: "Comment les Narcos ont Envahi Miami dans les Ann√©es 80 ?",
      category: "Crime, Mafia & Cartels",
      description: "Une plong√©e dans l'explosion du trafic de drogue √† Miami dans les ann√©es 80.",
      url: "https://youtu.be/GohIzlJV_8A?si=SgZvhMwQdR63XIgP",
    },
    {
      id: "2",
      title: "L'Ennemi jur√© de Pablo Escobar (Le Cartel de Cali)",
      category: " Crime, Mafia & Cartels",
      description: "D√©couverte du cartel rival de Pablo Escobar.",
      url: "https://youtu.be/I5lkEs6YtJo?si=4mOZBQL2X-eq1BsK",
    },
    {
      id: "3",
      title: "Guant√°namo : une mauvaise base ?",
      category: "Politique, Dictature & G√©opolitique",
      description: "Un reportage sur les enjeux politiques et humains li√©s √† la prison de Guant√°namo.",
      url: "https://youtu.be/OgYvEg6CfQc?si=ryCc6k0Zobfufcsb",
    },
    {
      id: "4",
      title: "L'Histoire du Dictateur Russe le Plus Meurtrier",
      category: "Politique, Dictature & G√©opolitique",
      description: "Exploration du parcours sanglant du dictateur le plus meurtrier de Russie.",
      url: "https://youtu.be/7ziqAXuZwe8?si=8anKdlhhCNnG56sZ",
    },
    {
      id: "5",
      title: "L'incroyable histoire de Kadhafi | Partie 1",
      category: "Biographies & Figures Historiques",
      description: "Le parcours fascinant et tragique de Kadhafi, dictateur libyen.",
      url: "https://youtu.be/Xo32cvtnkl0?si=iW4otYeIs8LEUYdc",
    },
    {
      id: "6",
      title: "La scandaleuse histoire de la France en Afrique",
      category: "Politique, Dictature & G√©opolitique",
      description: "D√©cryptage des relations postcoloniales entre la France et l'Afrique.",
      url: "https://youtu.be/drc6D-icdFk?si=kY2TTkJYT-PwaTf1",
    },
    {
      id: "7",
      title: "Le Dictateur le Plus Meurtrier de la Chine",
      category: "Politique, Dictature & G√©opolitique",
      description: "Retour sur l'impact tragique du r√®gne de Mao Zedong.",
      url: "https://youtu.be/3cV4QwA6wuA?si=lB90M3kQvMFKZV1p",
    },
    {
      id: "8",
      title: "Les 638 tentatives de la CIA pour assassiner Fidel Castro ?",
      category: "Politique, Dictature & G√©opolitique",
      description: "Un √©pisode fascinant sur les multiples tentatives de la CIA contre Castro. ",
      url: "https://youtu.be/VTSeoh8hS2k?si=v2UouYmIZQEqbT6f",
    },
    {
      id: "9",
      title: "Les derniers secrets de l'affaire Kennedy",
      category: "Affaires, Enqu√™tes & Myst√®res Historiques",
      description: "Analyse des documents r√©cemment d√©classifi√©s sur l'affaire Kennedy.",
      url: "https://youtu.be/4URa7_2Z8hA?si=-4AallZyaeXbkieK",
    },
    {
      id: "10",
      title: "L'histoire du premier milliardaire du monde",
      category: "Finance, Richesse & Pouvoir",
      description: "Biographie du premier milliardaire de l'histoire.Monsieur Rockerfeller est un des plus grand milliardaires de l'histoire.",
      url: "https://youtu.be/_Bn7Mq9OuAI?si=941Eefu0oomM33ZW",
    },
    {
      id: "11",
      title: "Shazam : l‚Äôincroyable histoire de l‚Äôapp la plus puissante du monde",
      category: "Technologie & R√©volutions Modernes",
      description: `La vid√©o retrace l'incroyable histoire de Shazam , n√©e avant l'iPhone de la frustration de Chris Barton et concr√©tis√©e par la technologie d'Avery Wang. 
    Elle d√©crit les d√©fis techniques pour reconna√Ætre les chansons, la cr√©ation d'une immense base de donn√©es, et son lancement initial par t√©l√©phone en 2002. 
    L'arriv√©e de l'App Store en 2008 a propuls√© l'application, menant √† son rachat strat√©gique par Apple en 2018.`,
      url: "https://youtu.be/H9xWk33zhro?si=HX2iuyArEeT8xNPx",
    },
    {
      id: "12",
      title: "Oppenheimer : Le p√®re de la bombe atomique",
      category: "Biographies & Figures Historiques",
      description: `La vid√©o d√©crit la biographie de Julius Robert Oppenheimer, le "p√®re de la bombe atomique", explorant sa vie et son g√©nie. 
    Elle d√©taille son r√¥le central √† la t√™te du Projet Manhattan, travaillant avec des figures comme le g√©n√©ral Leslie Groves et Edward Teller. 
    Le r√©cit aborde les d√©fis techniques et les profonds dilemmes √©thiques rencontr√©s lors de la cr√©ation de cette arme redoutable.`,
      url: "https://youtu.be/GIiqV8WvUpM?si=Pw1dC45oqMXDCIvq",
    },
    {
      id: "13",
      title: "Griselda Blanco : La Reine de la Coca√Øne",
      category: "Crime, Mafia & Cartels",
      description: `La vid√©o raconte l'histoire de Griselda Blanco, surnomm√©e "la reine de la coca√Øne", qui a mentor√© Pablo Escobar. 
    Elle d√©taille son ascension violente, ses m√©thodes pionni√®res pour le trafic aux √âtats-Unis avec **Alberto Bravo** et son r√¥le dans la guerre des "cocaine cowboys" √† Miami. 
    Le r√©cit se termine par son arrestation par l'agent Bob Palombo et son assassinat √† Medell√≠n.`,
      url: "https://youtu.be/dqrpBCnu_Rc?si=4YsZy3W-E0O7laVy",
    },
    {
      id: "14",
      title: "LUCKY LUCIANO : Chef Supr√™me de la Mafia Am√©ricaine",
      category: "Crime, Mafia & Cartels",
      description: `La vid√©o raconte l'ascension de Lucky Luciano apr√®s l'√©limination de Joe Masseria et Salvatore Maranzano, menant √† la cr√©ation de la Commission. 
    Elle d√©crit ses d√©m√™l√©s avec la justice men√©s par **Thomas Dewey**, son incarc√©ration, sa d√©portation aid√©e par des figures comme Meyer Lansky. 
    Le r√©cit culmine avec la conf√©rence de La Havane o√π il r√©affirme son leadership face √† **Vito Genovese** et o√π la mort de Bugsy Siegel est d√©cid√©e.`,
      url: "https://youtu.be/jUjJZO22XyA?si=KJ_kdqtPubzad5_W",
    },
    {
      id: "15",
      title: "L'assassinat de Malcolm X : L'histoire m√©connue",
      category: "Affaires, Enqu√™tes & Myst√®res Historiques",
      description: `La vid√©o retrace l'assassinat de Malcolm X le 21 f√©vrier 1965 √† Harlem. 
    Elle explore sa rupture avec la Nation of Islam d'Elijah Muhammad, les menaces qui en ont d√©coul√© et l'implication de membres comme Thomas Hagan, Norman Butler et Thomas Johnson dans sa mort. 
    Le r√©cit aborde √©galement ses efforts d'alliances (dont Martin Luther King) et les questions entourant le r√¥le potentiel d'agences comme le FBI de J. Edgar Hoover.`,
      url: "https://youtu.be/5l-lC3oVde4?si=wmgKTV8ALbXhd4CW",
    },
    {
      id: "16",
      title: "Martin Luther King, Jr., 'What Is Your Life's Blueprint?'",
      category: "Biographies & Figures Historiques",
      description: `La vid√©o pr√©sente le discours du R√©v√©rend Dr. Martin Luther King Jr. s'adressant aux √©tudiants de Barrett Junior High School. 
    Il les exhorte √† d√©finir leur "plan de vie" en se basant sur une foi profonde en leur dignit√© et valeur personnelle. 
    Le plan inclut √©galement un engagement √† atteindre l'excellence et √† participer √† la lutte pour la libert√© et la justice.`,
      url: "https://youtu.be/ZmtOGXreTOU?si=fWK1rQQ-i4LM41qG",
    },
    {
      id: "17",
      title: "L'Histoire du Plus Vicieux des üá≥azis !",
      category: "Politique, Dictature & G√©opolitique",
      description: `La vid√©o raconte la vie de Joseph Goebbels, le "g√©nie diabolique" de la propagande nazie et l'un des manipulateurs les plus meurtriers du 20e si√®cle. 
    Elle d√©taille son admiration pour Adolf Hitler, son r√¥le dans l'ascension des nazis et l'instigation de pers√©cutions, notamment contre les Juifs. 
    Le r√©cit s'ach√®ve sur sa nomination comme chancelier apr√®s la mort d'Hitler et son suicide avec sa femme Magda apr√®s l'assassinat de leurs enfants.`,
      url: "https://youtu.be/AjUVxLu-iK8?si=6Ujllwl3WwWvv0kl",
    },
    {
      id: "18",
      title: "La sombre v√©rit√© de la famille la plus riche de l‚ÄôHistoire..",
      category: "Finance, Richesse & Pouvoir",
      description: `La vid√©o retrace l'histoire de la dynastie Rothschild, fond√©e par Mayer Amschel Rothschild √† Francfort, d√©crivant son ascension d'agent de cour √† banquier. 
    Elle explique comment ses cinq fils, dont Nathan √† Londres et James √† Paris, ont √©tendu leur r√©seau bancaire √† travers l'Europe, finan√ßant guerres et projets industriels. 
    Le r√©cit aborde l'influence continue de la famille (avec des figures comme Guy et **Jacob Rothschild**), les pers√©cutions subies et les th√©ories de complot qui l'entourent.`,
      url: "https://youtu.be/9ZROQtBeLvE?si=zrI9yj1f_4Ka_tOP",
    },
    {
      id: "19",
      title: "La vie de Sam Altman : Visionnaire de l'IA",
      category: "Technologie & R√©volutions Modernes",
      description: `La vid√©o retrace la vie et l'ascension de **Sam Altman**, d√©crit comme un visionnaire et manipulateur visant √† cr√©er une IA surpassant l'homme. 
    Elle d√©taille son parcours, de Y Combinator (sous Paul Graham) √† la co-fondation d'OpenAI (avec Elon Musk, Ilya Sutskever, Greg Brockman). 
    Le r√©cit couvre le succ√®s de ChatGPT, le partenariat avec Microsoft, sa rivalit√© avec **Musk** et les conflits internes qui ont men√© √† son bref licenciement puis retour √† la t√™te d'OpenAI.`,
      url: "https://youtu.be/i-VYyq_nm2g?si=RKV6zIkyKB9sugLh",
    },
    {
      id: "20",
      title: "Dans les coulisses du blanchiment d'argent mondial",
      category: "Crime, Mafia & Cartels",
      description: `Plongez dans le monde secret o√π **pirates, trafiquants et criminels** s'ing√©nient √† dissimuler l'origine illicite de leurs fortunes. 
      Des combines artisanales aux r√©seaux financiers complexes, d√©couvrez comment **identit√©s vol√©es**, **soci√©t√©s √©crans** dans des paradis fiscaux et **jeux d'argent massifs** sont utilis√©s pour "laver" des milliards.
      M√™me les **march√©s virtuels de jeux vid√©o** ou les **cryptomonnaies** deviennent des canaux discrets pour ces transactions douteuses.
      Explorez l'ing√©niosit√© d√©moniaque de montages : **fausses factures**, **pr√™ts adoss√©s**, **banques complices** ‚Äî autant d'armes dans cette guerre invisible contre la tra√ßabilit√©.
      Une plong√©e fascinante dans un univers o√π l'argent sale, une fois blanchi, peut s'infiltrer et contr√¥ler des pans entiers de l'√©conomie mondiale.`,
      url: "https://www.youtube.com/watch?v=iL5LC0a7KJY&t=385s",
    },
    {
      id: "21",
      title: "Duolingo : La chouette qui a gamifi√© l'√©ducation",
      category: "Technologie & R√©volutions Modernes",
      description: `Cette vid√©o plonge au c≈ìur du succ√®s fulgurant de **Duolingo**, l'application √† la c√©l√®bre chouette verte devenue incontournable dans l'apprentissage des langues. 
      Elle retrace le parcours de **Luis von Ahn**, son fondateur visionnaire et inventeur du **CAPTCHA**, qui a d'abord con√ßu Duolingo pour traduire le web avant de se tourner vers l'√©ducation linguistique.
      Gr√¢ce √† une **gamification pouss√©e**, l'application rend l'apprentissage aussi **addictif qu‚Äôun jeu vid√©o**, utilisant des notifications personnalis√©es, de la culpabilisation, des classements, et des barres de progression.
      Si son mod√®le freemium et son taux de r√©tention impressionnent, certaines √©tudes interrogent son efficacit√© r√©elle pour atteindre la fluidit√©.
      On y d√©couvre aussi **Duo**, la mascotte devenue un m√®me Internet, et **Duolingo Max**, une nouvelle fonctionnalit√© boost√©e √† l'IA.
      Malgr√© des revenus inf√©rieurs √† certains concurrents, la soci√©t√© est valoris√©e √† **15 milliards de dollars**, et Luis von Ahn est aujourd'hui milliardaire.`,
      url: "https://www.youtube.com/watch?v=csYRchkbomY",
    }
    
    
    
    
    
    
    
  ]

  // Clean and trim category strings
  videos.forEach((video) => {
    video.category = video.category.trim()
  })

  // DOM elements
  const searchInput = document.getElementById("search-input")
  const categoryDropdown = document.getElementById("category-dropdown")
  const categoryButton = categoryDropdown.querySelector(".dropdown-button")
  const categoryOptions = document.getElementById("category-options")
  const selectedCategory = document.getElementById("selected-category")
  const videoGrid = document.getElementById("video-grid")
  const resultsCount = document.getElementById("results-count")
  const noResults = document.getElementById("no-results")
  const videoCardTemplate = document.getElementById("video-card-template")

  // Extract unique sorted categories for filters
  const categories = [...new Set(videos.map((video) => video.category))].sort()

  // Current filter state
  let currentSearchQuery = ""
  let currentCategory = "All Categories"

  // Initialize the application
  function init() {
    populateCategoryOptions()
    setupEventListeners()
    renderVideos()
  }

  // Populate category dropdown options
  function populateCategoryOptions() {
    // Add "All Categories" option
    const allOption = document.createElement("div")
    allOption.className = "dropdown-option selected"
    allOption.textContent = "All Categories"
    allOption.dataset.value = "All Categories"
    categoryOptions.appendChild(allOption)

    // Add category options
    categories.forEach((category) => {
      const option = document.createElement("div")
      option.className = "dropdown-option"
      option.textContent = category
      option.dataset.value = category
      categoryOptions.appendChild(option)
    })
  }

  // Setup event listeners
  function setupEventListeners() {
    // Search input
    searchInput.addEventListener("input", function () {
      currentSearchQuery = this.value.toLowerCase()
      renderVideos()
    })

    // Category dropdown toggle
    categoryButton.addEventListener("click", () => {
      categoryOptions.classList.toggle("show")
    })

    // Category options selection
    categoryOptions.addEventListener("click", (e) => {
      if (e.target.classList.contains("dropdown-option")) {
        const value = e.target.dataset.value
        currentCategory = value
        selectedCategory.textContent = value

        // Update selected class
        categoryOptions.querySelectorAll(".dropdown-option").forEach((option) => {
          option.classList.remove("selected")
        })
        e.target.classList.add("selected")

        // Close dropdown
        categoryOptions.classList.remove("show")

        // Update videos
        renderVideos()
      }
    })

    // Close dropdown when clicking outside
    document.addEventListener("click", (e) => {
      if (!categoryDropdown.contains(e.target)) {
        categoryOptions.classList.remove("show")
      }
    })
  }

  // Function to extract YouTube video ID from various URL formats
  function extractYouTubeVideoId(url) {
    if (!url) return null

    let match

    if (url.includes("youtu.be/")) {
      match = url.match(/youtu\.be\/([^?&]+)/)
      if (match && match[1]) return match[1]
    }

    match = url.match(/(?:youtube\.com\/(?:[^/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?/\s]{11})/)
    if (match && match[1]) return match[1]

    if (url.includes("youtu.be/")) {
      const parts = url.split("youtu.be/")[1].split("?")[0].split("/")[0]
      if (parts) return parts
    }

    console.warn("Could not extract YouTube video ID from URL:", url)
    return "dQw4w9WgXcQ" // Default fallback
  }

  // Generate a YouTube thumbnail URL
  function getYouTubeThumbnail(url) {
    const videoId = extractYouTubeVideoId(url)
    return `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
  }

  // Render videos based on current filters
  function renderVideos() {
    const filteredVideos = videos.filter((video) => {
      const matchesSearch =
        video.title.toLowerCase().includes(currentSearchQuery) ||
        video.description.toLowerCase().includes(currentSearchQuery)

      const matchesCategory =
        currentCategory === "All Categories" || video.category === currentCategory

      return matchesSearch && matchesCategory
    })

    resultsCount.textContent = `Showing ${filteredVideos.length} of ${videos.length} documentaries`

    videoGrid.innerHTML = ""

    if (filteredVideos.length === 0) {
      noResults.style.display = "block"
    } else {
      noResults.style.display = "none"

      filteredVideos.forEach((video) => {
        const videoCard = videoCardTemplate.content.cloneNode(true)
        videoCard.querySelector(".thumbnail").src = getYouTubeThumbnail(video.url)
        videoCard.querySelector(".thumbnail").alt = video.title
        videoCard.querySelector(".video-title").textContent = video.title
        videoCard.querySelector(".video-category").textContent = video.category
        videoCard.querySelector(".video-description").textContent = video.description
        videoCard.querySelector(".watch-button").href = video.url
        videoGrid.appendChild(videoCard)
      })
    }
  }

  // Initialize
  init()
})
